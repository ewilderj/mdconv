{
  "version": 3,
  "sources": ["../src/platforms/firefox/background.ts"],
  "sourcesContent": ["/**\n * Firefox extension background script.\n * Handles context menu creation and selection-to-markdown conversion.\n * Uses browser.* API which works in both Firefox and modern Chrome.\n */\n/// <reference types=\"chrome\" />\n\n// Cross-browser compatibility shim - Firefox provides browser, Chrome provides chrome\ndeclare const browser: typeof chrome;\nif (typeof browser === 'undefined') {\n  // @ts-ignore - make browser available in Chrome\n  globalThis.browser = chrome;\n}\n\n/**\n * Shows a success or failure badge on the extension icon for 2 seconds.\n * @param success - Whether to show success (\u2713) or failure (\u2717) badge\n */\nasync function showFirefoxBadge(success: boolean): Promise<void> {\n  if (success) {\n    await browser.action.setBadgeText({ text: \"\u2713\" });\n    await browser.action.setBadgeBackgroundColor({ color: \"#1b8a5a\" });\n  } else {\n    await browser.action.setBadgeText({ text: \"\u2717\" });\n    await browser.action.setBadgeBackgroundColor({ color: \"#d93025\" });\n  }\n  \n  setTimeout(() => {\n    browser.action.setBadgeText({ text: \"\" });\n  }, 2000);\n}\n\nbrowser.runtime.onInstalled.addListener(() => {\n  // Create context menu item for text selection\n  browser.contextMenus.create({\n    id: \"copyAsMarkdown\",\n    title: \"Copy as Markdown\",\n    contexts: [\"selection\"]\n  });\n  \n  // Create context menu item for extension icon (right-click on toolbar icon)\n  browser.contextMenus.create({\n    id: \"openHelp\",\n    title: \"How to use\",\n    contexts: [\"action\"]\n  });\n});\n\n// Handle keyboard shortcut command\nbrowser.commands.onCommand.addListener(async (command) => {\n  if (command === \"convert-clipboard\") {\n    // Get the active tab to run the content script\n    const [tab] = await browser.tabs.query({ active: true, currentWindow: true });\n    if (!tab?.id) {\n      // No active tab - silent no-op\n      return;\n    }\n\n    try {\n      let response;\n      \n      try {\n        // Try to send message to content script first\n        response = await browser.tabs.sendMessage(tab.id, {\n          action: \"convertSelectionForShortcut\"\n        });\n      } catch (error) {\n        // If content script isn't available, inject it and try again\n        await browser.scripting.executeScript({\n          target: { tabId: tab.id },\n          files: ['content-script.js']\n        });\n        \n        // Wait a moment for the script to load\n        await new Promise(resolve => setTimeout(resolve, 100));\n        \n        // Try sending the message again\n        response = await browser.tabs.sendMessage(tab.id, {\n          action: \"convertSelectionForShortcut\"\n        });\n      }\n      \n      // No selection = silent no-op (matches Cmd+C behavior)\n      if (response?.noSelection) {\n        return;\n      }\n      \n      await showFirefoxBadge(response?.success ?? false);\n    } catch (error) {\n      await showFirefoxBadge(false);\n    }\n  }\n});\n\nbrowser.contextMenus.onClicked.addListener(async (info, tab) => {\n  // Handle help menu item\n  if (info.menuItemId === \"openHelp\") {\n    await browser.tabs.create({\n      url: \"https://github.com/ewilderj/mdconv/blob/main/HELP.md\"\n    });\n    return;\n  }\n  \n  if (info.menuItemId === \"copyAsMarkdown\" && info.selectionText && tab?.id) {\n    try {\n      let response;\n      \n      try {\n        // Try to send message to content script first\n        response = await browser.tabs.sendMessage(tab.id, {\n          action: \"convertSelection\"\n        });\n      } catch (error) {\n        // If content script isn't available, inject it and try again\n        await browser.scripting.executeScript({\n          target: { tabId: tab.id },\n          files: ['content-script.js']\n        });\n        \n        // Wait a moment for the script to load\n        await new Promise(resolve => setTimeout(resolve, 100));\n        \n        // Try sending the message again\n        response = await browser.tabs.sendMessage(tab.id, {\n          action: \"convertSelection\"\n        });\n      }\n      \n      if (response && response.success) {\n        await showFirefoxBadge(true);\n      } else {\n        throw new Error(response?.error || \"Conversion failed\");\n      }\n    } catch (error) {\n      await showFirefoxBadge(false);\n    }\n  }\n});\n"],
  "mappings": "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",
  "names": []
}
